<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-build/groundwork/dns-dhcp" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.0.1">
<title data-rh="true">Setting up Gravity (DHCP + DNS) | Riff Labs</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://labs.riff.cc/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://labs.riff.cc/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://labs.riff.cc/docs/build/groundwork/dns-dhcp"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Setting up Gravity (DHCP + DNS) | Riff Labs"><meta data-rh="true" name="description" content="We&#x27;ll now set up our DNS and DHCP service, used for assigning IP addresses to devices on our network and translating domain names to IP addresses."><meta data-rh="true" property="og:description" content="We&#x27;ll now set up our DNS and DHCP service, used for assigning IP addresses to devices on our network and translating domain names to IP addresses."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://labs.riff.cc/docs/build/groundwork/dns-dhcp"><link data-rh="true" rel="alternate" href="https://labs.riff.cc/docs/build/groundwork/dns-dhcp" hreflang="en"><link data-rh="true" rel="alternate" href="https://labs.riff.cc/docs/build/groundwork/dns-dhcp" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.d875fe7e.css">
<script src="/assets/js/runtime~main.46d4dcdf.js" defer="defer"></script>
<script src="/assets/js/main.76b375df.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="A series of dots or stars, forming the Riff.CC logo." class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="A series of dots or stars, forming the Riff.CC logo." class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Riff.CC Labs</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/build/intro">Build</a><a class="navbar__item navbar__link" href="/docs/maintain/intro">Maintain</a><a class="navbar__item navbar__link" href="/docs/monitor/intro">Monitor</a><a class="navbar__item navbar__link" href="/docs/automate/intro">Automate</a></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/build/intro">Riff.CC Labs</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/setup---networking-and-basics">Setup - Networking and Basics</a><button aria-label="Collapse sidebar category &#x27;Setup - Networking and Basics&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build/groundwork/initial-details">Initial details</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build/groundwork/setting-up-a-router">Setting up a router</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build/groundwork/the-first-server">The first server</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build/groundwork/your-first-cluster">Your first cluster</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/build/groundwork/dns-dhcp">Setting up Gravity (DHCP + DNS)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build/groundwork/your-first-vm">Your first VM</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/build/groundwork/conclusion">Conclusion</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/setup---getting-airborne">Setup - Getting Airborne</a><button aria-label="Expand sidebar category &#x27;Setup - Getting Airborne&#x27;" type="button" class="clean-btn menu__caret"></button></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/setup---networking-and-basics"><span itemprop="name">Setup - Networking and Basics</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Setting up Gravity (DHCP + DNS)</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Setting up Gravity (DHCP + DNS)</h1>
<p>We&#x27;ll now set up our DNS and DHCP service, used for assigning IP addresses to devices on our network and translating domain names to IP addresses.</p>
<p>For this, we&#x27;ll use a service called <a href="https://gravity.beryju.io/" target="_blank" rel="noopener noreferrer">Gravity</a>, which is excellent because it provides something called High Availability.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-youll-need">What you&#x27;ll need<a href="#what-youll-need" class="hash-link" aria-label="Direct link to What you&#x27;ll need" title="Direct link to What you&#x27;ll need">​</a></h2>
<ul>
<li>A working Proxmox cluster</li>
</ul>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-high-availability">What is High Availability?<a href="#what-is-high-availability" class="hash-link" aria-label="Direct link to What is High Availability?" title="Direct link to What is High Availability?">​</a></h2>
<p>High Availability refers to systems that are designed to withstand the failure of one or more components and continue operating. This is important for a home lab, because we don&#x27;t want to have to worry about our DNS and DHCP service going down if one of our servers goes down - especially since it provides a network connection for a friend of mine!</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-gravity">What is Gravity?<a href="#what-is-gravity" class="hash-link" aria-label="Direct link to What is Gravity?" title="Direct link to What is Gravity?">​</a></h2>
<p>Gravity is a &quot;fully replicated DNS and DHCP server&quot; that uses <a href="https://raft.github.io/" target="_blank" rel="noopener noreferrer">Raft</a> and <code>etcd</code> to provide High Availability. It&#x27;s a great fit for our lab, and it&#x27;s also very easy to set up.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="installing-gravity">Installing Gravity<a href="#installing-gravity" class="hash-link" aria-label="Direct link to Installing Gravity" title="Direct link to Installing Gravity">​</a></h2>
<p>The first step in installing Gravity is to log into our servers for the first time using something called &quot;SSH&quot;.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="what-is-ssh">What is SSH?<a href="#what-is-ssh" class="hash-link" aria-label="Direct link to What is SSH?" title="Direct link to What is SSH?">​</a></h3>
<p>SSH is a protocol that allows you to log into a remote server and execute commands on it. It&#x27;s lightweight, fast and secure, and is the preferred way to log into Linux servers remotely. It&#x27;s also the way Ansible will communicate with our servers, allowing us to do things like patch systems and apply security updates, or install new software.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="logging-into-your-servers">Logging into your servers<a href="#logging-into-your-servers" class="hash-link" aria-label="Direct link to Logging into your servers" title="Direct link to Logging into your servers">​</a></h3>
<p>To log into your servers, you&#x27;ll need to use an SSH client. If you&#x27;re on Windows, you can install a copy of Ubuntu using something called Windows Subsystem for Linux (WSL or &quot;Whistle&quot;). If you&#x27;re on Linux or macOS, you can simply open a terminal and use the <code>ssh</code> command.</p>
<p>You&#x27;ll need to know the IP address of your servers. If you don&#x27;t know them, you can find them in the Proxmox web interface under Datacenter -&gt; Nodes. You&#x27;ll also need to know the root username and password for each of your servers.</p>
<p>Once you know the IP address, open your terminal or WSL and type the following command:</p>
<p><code>ssh-keygen -t ed25519</code></p>
<p>When prompted, enter a password that you can remember but that is hard to guess. This will be used to encrypt your SSH key, which is used to log into your servers. Typically a four or five random word password is sufficient.</p>
<p>Once you&#x27;ve done that, you&#x27;ll need to copy your SSH key to your servers. You can do this by typing the following command:</p>
<p><code>ssh-copy-id root@ip-of-server</code></p>
<p>It should prompt you for your server&#x27;s root password. Enter it, and it should copy your SSH key to your server. You can test this by typing the following command:</p>
<p><code>ssh root@ip-of-server</code></p>
<p>If it asks you for a password, something went wrong. If it logs you in, you&#x27;re good to go!</p>
<div class="theme-admonition theme-admonition-warning admonition_xJq3 alert alert--warning"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>warning</div><div class="admonitionContent_BuS1"><p>Logging in as root is not something you should do on a regular basis - or if you can help it, at all. Root is the most powerful account in just about any Linux system, and it&#x27;s very easy to break things with if you&#x27;re not careful.</p></div></div>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="installing-docker">Installing Docker<a href="#installing-docker" class="hash-link" aria-label="Direct link to Installing Docker" title="Direct link to Installing Docker">​</a></h3>
<div class="theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>danger</div><div class="admonitionContent_BuS1"><p>Installing Docker on top of Proxmox changes the way that Proxmox networking works, and as you can imagine can cause various issues. Heavily modifying the &quot;Debian&quot; side of Proxmox (ie: the base operating system, as opposed to VMs and containers running on top of it) is not usually a good idea. This is NOT recommended as a long term solution - it would be much better to create dedicated VMs or containers with which to run Gravity, which is what we will be migrating to later on. However, as a way of getting things up and running quickly, this is &quot;fine&quot;.</p></div></div>
<p>The first thing we&#x27;ll do once we&#x27;ve logged into our new servers is install Docker. Docker is a container runtime that allows us to run software in containers. We&#x27;ll be using Docker to run Gravity on each of our nodes, and to keep it nice and self-contained.</p>
<p>We&#x27;ll install Docker the &quot;evil&quot; way - by doing something called <strong>curling to bash</strong>. This is bad, and you shouldn&#x27;t usually do it, but it&#x27;s the easiest way to install Docker. If you&#x27;re curious, you can read more about why it&#x27;s bad <a href="https://sysdig.com/blog/friends-dont-let-friends-curl-bash/" target="_blank" rel="noopener noreferrer">here</a>.</p>
<p>Open your shell, make sure you&#x27;re logged into your server, and type the following command:</p>
<p><code>curl -fsSL get.docker.com | bash</code></p>
<p>This will install, set up and start Docker on your server. Once it&#x27;s done, you can test it by typing the following command:</p>
<p><code>docker ps</code></p>
<p>It should print out an empty list of running containers.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="starting-gravity">Starting Gravity<a href="#starting-gravity" class="hash-link" aria-label="Direct link to Starting Gravity" title="Direct link to Starting Gravity">​</a></h3>
<p>Now that we have Docker installed, we can install Gravity. We&#x27;ll do this by using a tool called <code>docker-compose</code>, which allows us to run multiple containers at once. There&#x27;s actually a variant of Docker Compose built into the main Docker distribution now, which you can use by simply replacing the &quot;-&quot; in <code>docker-compose</code> - the command people would usually use - with a space - so, <code>docker compose</code>.</p>
<p>To install Gravity, we&#x27;ll need to create a directory to store our configuration files. We&#x27;ll do this by typing the following command:</p>
<p><code>mkdir /opt/gravity</code></p>
<p>Then, we&#x27;ll create a file called <code>docker-compose.yml</code> in that directory. We&#x27;ll do this by typing the following command:</p>
<p><code>editor /opt/gravity/docker-compose.yml</code></p>
<p>This will open a text editor, which will most likely be a text editor called <code>nano</code>. We&#x27;ll paste the following into it:</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token punctuation" style="color:#393A34">---</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;3.4&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">gravity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Important for this to be static and unique</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">hostname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> name</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">of</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">your</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">node</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ghcr.io/beryju/gravity</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">stable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> unless</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">stopped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">network_mode</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> host</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># environment:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">#   LOG_LEVEL: info</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># The default log level of info logs DHCP and DNS queries, so ensure</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># the logs aren&#x27;t filling up the disk</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">logging</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">driver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> json</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">options</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">max-size</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;10m&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">max-file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;3&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">volumes</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">data</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">driver</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> local</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Replace the phrase <code>name-of-your-node</code> with the name of your node. If you&#x27;ve forgotten, you can find this in the Proxmox web interface under Datacenter -&gt; Nodes.</p>
<p>Once you&#x27;ve done that, save the file and exit the editor. You can do this by hitting Ctrl+X, typing the letter &quot;y&quot;, and then hitting Enter/Return.</p>
<p>Then, type the following command:</p>
<p><code>cd /opt/gravity &amp;&amp; docker compose up -d</code></p>
<p>You should now see something like this appear. It may take a few minutes for everything to spin up.</p>
<p><img loading="lazy" alt="Gravity starting up via Docker Compose" src="/assets/images/gravity-initial-boot-abbf5f98813ab9f55a07b8a2b33e5a21.png" width="495" height="193" class="img_ev3q"></p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="logging-in">Logging in<a href="#logging-in" class="hash-link" aria-label="Direct link to Logging in" title="Direct link to Logging in">​</a></h2>
<p>Now that we have Gravity up and running, we&#x27;ll need to configure it. We have a &quot;single node cluster&quot;, which is bad because this also means we have a &quot;single point of failure&quot;.</p>
<p>If our node goes down, our entire DNS and DHCP service goes down with it. Luckily, we&#x27;re not using Gravity yet - most likely, your router is still providing DNS and DHCP services. We&#x27;ll &quot;cut over&quot; to the Gravity setup once we&#x27;ve made it <em>highly available</em>.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="visiting-your-first-gravity-node">Visiting your first Gravity node<a href="#visiting-your-first-gravity-node" class="hash-link" aria-label="Direct link to Visiting your first Gravity node" title="Direct link to Visiting your first Gravity node">​</a></h3>
<p>To visit your first Gravity node, you&#x27;ll need your IP address again, such as 10.1.1.151.</p>
<p>Navigate to <code>http://ip-of-your-node:8008</code> in your web browser. You should see a screen like this:</p>
<p><img loading="lazy" alt="A login form for Gravity, with space as a backdrop and a big GRAVITY text logo. Below is the Earth, with its curvature clearly visible. Above, just barely colliding with the login form, is an astronaut in a traditional spacesuit. Image credit: NASA (background), BeryJu (software)." src="/assets/images/gravity-login-c1b9b447c554f0b10f90bedc05587c90.png" width="1778" height="1290" class="img_ev3q"></p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="getting-your-password">Getting your password<a href="#getting-your-password" class="hash-link" aria-label="Direct link to Getting your password" title="Direct link to Getting your password">​</a></h3>
<p>The default username is <code>admin</code>, but we don&#x27;t actually know the password yet! We&#x27;ll need to examine Docker&#x27;s <strong>logs</strong> to find it.</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p>Logs are a critical way to determine what servers, clusters, services and various other parts of technology are doing. They give you a pulse on what&#x27;s happening and are very useful for troubleshooting and debugging. Learning to master logs, logging and monitoring will lead you to become a better engineer.</p></div></div>
<p>First, examine what&#x27;s running on your Docker host by typing the following command:</p>
<p><code>docker ps</code></p>
<p>You&#x27;ll see output like this:</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">root@monstar:/opt/gravity# docker ps</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CONTAINER ID   IMAGE                           COMMAND                  CREATED         STATUS         PORTS     NAMES</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">e176f2ae34e2   ghcr.io/beryju/gravity:stable   &quot;/bin/gravity server&quot;    9 minutes ago   Up 9 minutes             gravity-gravity-1</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You&#x27;ll want to note the &quot;CONTAINER ID&quot; of your Gravity container. In this case, it&#x27;s <code>e176f2ae34e2</code>.</p>
<p>Then, type the following command:</p>
<p><code>docker logs e17 2&gt;&amp;1 | grep -B3 -A2 &quot;Password&quot;</code></p>
<p>There&#x27;s a LOT to unpack in this short command, so let&#x27;s go over it!</p>
<p><code>docker</code>: This is the &quot;executable&quot; or program that we ran, which in this case is just called &quot;docker&quot;.</p>
<p><code>logs</code>: This is an <em>argument</em> we passed to docker, which tells it to show us the logs of a particular container. In this case, Docker takes that argument and runs a <code>subcommand</code> called <code>logs</code>.</p>
<p><code>e17</code>: This is another argument, which is passed first to the Docker executable and then to the <code>logs</code> subcommand. (&quot;Subcommand&quot; is a pretty nebulous term for this, so don&#x27;t get too attached to it.) This argument tells Docker which container we want to see the logs for. You&#x27;ll probably note that we didn&#x27;t actually need to type <code>e176f2ae34e2</code> - we just typed <code>e17</code> and Docker knew what we meant. This is because Docker is smart enough to know that <code>e17</code> is unique enough to identify a single container. In a system with many running containers, you&#x27;ll have a harder time writing shorthand for containers, as there might have been more than one &quot;e17&quot; container running - in which case Docker would politely return an error. Neat!</p>
<p><code>2&gt;&amp;1</code>: This is a special bit of syntax that tells the shell to redirect the output of the command to the right of it to the same place as the output of the command to the left of it. In this case, it tells the shell to redirect the &quot;stderr&quot; (standard error) output of the command into the &quot;stdout&quot; (standard out) stream, which is necessary to allow you to be able to run commands like <code>grep</code> on the output of the <code>docker logs</code> command. Note that this is an argument we are passing to the <em>shell</em>, not to Docker!</p>
<div class="theme-admonition theme-admonition-info admonition_xJq3 alert alert--info"><div class="admonitionHeading_Gvgb"><span class="admonitionIcon_Rf37"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_BuS1"><p><strong>Wait, what&#x27;s a shell?</strong></p><p>A shell is simply what you&#x27;ve been typing your commands into when you&#x27;ve been executing them. There are various kinds of shells - chances are you&#x27;re using either one called Bash (&quot;Bourne Again Shell&quot;) or zsh (&quot;Z Shell&quot;). There are many others, such as fish, csh, ksh, and so on. They all have their own quirks and features, but they all do the same thing - they allow you to execute commands on your computer.</p></div></div>
<p><code>|</code>: This is another special bit of syntax that tells the shell to take the output of the command to the left of it and &quot;pipe&quot; it to the command to the right of it. In this case, it tells the shell to take the output of the <code>logs</code> subcommand and pipe it to the <code>grep</code> subcommand.</p>
<p><code>grep</code>: Grep is about to be your new best friend if you&#x27;re unfamiliar with it. It&#x27;s a command that allows you to search for text in the output of a command. In this case, we&#x27;re searching for the word &quot;Password&quot; in the output of the <code>docker logs</code> command.</p>
<p><code>-B3</code>: This is an argument we&#x27;re passing to the <code>grep</code> command. It tells <code>grep</code> to show us the three lines <em>before</em> the line that matches our search term.</p>
<p><code>-A2</code>: This is another argument we&#x27;re passing to the <code>grep</code> command. It tells <code>grep</code> to show us the two lines <em>after</em> the line that matches our search term.</p>
<p>Ultimately, this command takes the logs from our Docker container, searches for the term &quot;Password&quot;, and shows us the three lines before and two lines after the line that matches our search term.</p>
<p>It produces the following lovely output:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">------------------------------------------------------------</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Welcome to gravity! An admin user has been created for you.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Username: &#x27;admin&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Password: &#x27;THIS-IS-NOT-MY-REAL-PASSWORD-SORRY-BUT-HAVE-SOME-CAKE&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Open &#x27;http://10.1.1.154:8008/&#x27; to start using Gravity!</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">--------------------------------------------------------------------</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Now that you&#x27;ve got your password, you can login to Gravity!</p>
<p>You <em>can</em> feel free to write down that password, by the way - but best practices indicate that you should always change an initial password as soon as possible to something secure and unique, then store that password in a secure location such as a password manager.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="logging-in-for-the-first-time">Logging in for the first time<a href="#logging-in-for-the-first-time" class="hash-link" aria-label="Direct link to Logging in for the first time" title="Direct link to Logging in for the first time">​</a></h3>
<p>Enter your username and password, and you&#x27;ll be presented with Gravity.</p>
<p><img loading="lazy" alt="The Gravity dashboard, first shown when you login to Gravity." src="/assets/images/gravity-dashboard-7022e96c843b213516dae167d4a19bec.png" width="1778" height="1288" class="img_ev3q"></p>
<p>Congratulations, you&#x27;ve installed Gravity! Let&#x27;s configure it.</p>
<h2 class="anchor anchorWithStickyNavbar_LWe7" id="configuring-gravity">Configuring Gravity<a href="#configuring-gravity" class="hash-link" aria-label="Direct link to Configuring Gravity" title="Direct link to Configuring Gravity">​</a></h2>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-dns-zone">Creating a DNS zone<a href="#creating-a-dns-zone" class="hash-link" aria-label="Direct link to Creating a DNS zone" title="Direct link to Creating a DNS zone">​</a></h3>
<p>The first thing we&#x27;ll do is setup a DNS zone. We&#x27;ll do this by clicking on the &quot;DNS&quot; tab, then clicking on &quot;Zones&quot;, then clicking on &quot;Create&quot;.</p>
<p><img loading="lazy" alt="The Zones section of Gravity" src="/assets/images/gravity-zones-bdfad89d443c5a2ca969d09cad090921.png" width="1778" height="1291" class="img_ev3q"></p>
<p>Once you&#x27;ve clicked Create, you&#x27;ll be presented with a basic form. For &quot;Name&quot;, fill in the domain name you chose earlier, such as <code>riff.cc</code>. Do not tick Authoritative unless you&#x27;ve got your own reason to - we&#x27;ll go over what that means later.</p>
<p><img loading="lazy" alt="Creating a Zone in Gravity" src="/assets/images/gravity-create-zone-1-6b79e4780d6ccdffdd546e443b590eb4.png" width="1781" height="1290" class="img_ev3q"></p>
<p>Click Next to move to the next part of the prompt.</p>
<p>Select &quot;Gravity-hosted&quot;.</p>
<p><img loading="lazy" alt="Selecting a zone configuration preset in Gravity." src="/assets/images/gravity-create-zone-2-62fc389b666b57d924c98f0bcb754f0f.png" width="1779" height="1288" class="img_ev3q"></p>
<p>Click through the rest of the prompts, then click Finish.</p>
<p>You&#x27;ll notice your domain now appears in the list of Zones - click it to view it.</p>
<p><img loading="lazy" alt="A list of Zones in Gravity" src="/assets/images/gravity-zone-list-a9bc05bbd1da816a44c1db062f23da37.png" width="1780" height="1289" class="img_ev3q"></p>
<p>Your DNS zone is configured, but it&#x27;s empty - it won&#x27;t do anything particularly useful yet. Let&#x27;s fix that. Click on the &quot;Create&quot; button to create your first DNS record.</p>
<p><img loading="lazy" alt="Creating a DNS record" src="/assets/images/gravity-create-dns-record-c04875c1085f9981b8e22185fc775be6.png" width="1778" height="1290" class="img_ev3q"></p>
<p>Fill in the form with the following information:</p>
<ul>
<li>
<p>Hostname: The name of your first Proxmox server, such as &quot;coheed&quot;.</p>
</li>
<li>
<p>UID: Leave this as 0. This UID number is a special number that allows us to create multiple records with the same hostname, but different values. We&#x27;ll use this for things like &quot;round robin DNS&quot; later, which you&#x27;ll learn about in a future section. For now, simply &quot;0&quot; will suffice.</p>
</li>
<li>
<p>Type: Select &quot;A&quot;. An A record is a simple mapping between a hostname such as <code>coheed.riff.cc</code> and an IPv4 address such as <code>10.1.1.151</code>.</p>
</li>
<li>
<p>Data: Enter the IP address of your first Proxmox server - in my case, 10.1.1.151.</p>
</li>
</ul>
<p>When you&#x27;re done, it&#x27;ll look something like this:</p>
<p><img loading="lazy" alt="Creating a DNS record, but the form is filled out now" src="/assets/images/gravity-create-dns-record-2-1f8a3302b8f23c2eb26c0c49a3c2c58c.png" width="1438" height="596" class="img_ev3q"></p>
<p>Hit Create, and your DNS record will appear. Repeat the process for each of your Proxmox servers, until your current network is fully mapped out.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-gravity-cluster">Creating a Gravity cluster<a href="#creating-a-gravity-cluster" class="hash-link" aria-label="Direct link to Creating a Gravity cluster" title="Direct link to Creating a Gravity cluster">​</a></h3>
<p>Now that we have Gravity up and running, we&#x27;ll want to create a cluster. This will allow us to have multiple Gravity nodes, which will allow us to have a highly available DNS and DHCP service. If one of our nodes goes down, the other nodes will be able to take over for it.</p>
<p>It&#x27;ll be a similar process to Proxmox, in a way - but with a Docker Compose style twist.</p>
<p>Click Cluster -&gt; Nodes in the Gravity sidebar to get started.</p>
<p><img loading="lazy" alt="A Gravity &amp;quot;cluster&amp;quot; with a single node in it." src="/assets/images/gravity-cluster-a83901cb880fdf98e29a18c025e66d4a.png" width="1779" height="1291" class="img_ev3q"></p>
<p>We want to take our other Proxmox nodes and &quot;join&quot; them to this Gravity cluster. To do so, you&#x27;ll want to follow the same steps you did to install Gravity on your first node, but with a few changes. Instead of pasting the original <code>docker-compose.yml</code> file, we&#x27;ll use one generated by Gravity itself.</p>
<p>Click on the &quot;Join&quot; button in the Gravity web interface, and you&#x27;ll be presented with a form. Uncheck the &quot;Debug&quot; box, enter your node&#x27;s unique name, and click &quot;Next&quot;.</p>
<p><img loading="lazy" alt="Joining a node to our Gravity cluster" src="/assets/images/gravity-join-node-a51a90238f49d5b72e06353b09f353bc.png" width="1450" height="995" class="img_ev3q"></p>
<p>Gravity will generate a pre-filled <code>docker-compose.yml</code> file for you. Copy the contents of this file, and paste it into your editor. Save it as <code>docker-compose.yml</code> in the <code>/opt/gravity</code> directory on your node, and then run <code>docker compose up -d</code> like you did before.</p>
<p>It&#x27;ll look something like this:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">version: &quot;3.4&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">services:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  gravity:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    hostname: al</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    image: ghcr.io/beryju/gravity:stable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    restart: unless-stopped</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    network_mode: host</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    user: root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    environment:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      ETCD_JOIN_CLUSTER: &lt;REDACTED-JOIN-TOKEN&gt;,http://10.1.1.154:8008</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      BOOTSTRAP_ROLES: dns;dhcp;api;etcd;discovery;monitoring;debug;tsdb</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      - data:/data</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    logging:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      driver: json-file</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      options:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        max-size: 10m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        max-file: &quot;3&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">volumes:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  data:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    driver: local</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p><img loading="lazy" alt="A pre-filled Docker Compose file for Gravity, with some light redaction." src="/assets/images/gravity-join-node-2-1456f54c09d0a23fd757b03114bcaf6a.png" width="1428" height="969" class="img_ev3q"></p>
<p>Once you&#x27;ve done that, you&#x27;ll see your node appear in the Gravity web interface.</p>
<p><img loading="lazy" alt="A Gravity cluster with two nodes in it." src="/assets/images/gravity-cluster-2-bc2dbf4db09468d2f9263be797aebe1e.png" width="1390" height="498" class="img_ev3q"></p>
<p>Repeat this process for each of your nodes, until you have a cluster with all of your nodes in it. You&#x27;ll need at least 3 for true &quot;quorum&quot;, though Gravity <em>technically</em> supports (but does NOT recommend) two node clusters through a couple of hacks.</p>
<h3 class="anchor anchorWithStickyNavbar_LWe7" id="creating-a-dhcp-scope">Creating a DHCP scope<a href="#creating-a-dhcp-scope" class="hash-link" aria-label="Direct link to Creating a DHCP scope" title="Direct link to Creating a DHCP scope">​</a></h3>
<p>Now that we have a cluster, we can create a DHCP pool. This will allow us to assign IP addresses to devices on our network. As a neat side bonus, Gravity will also keep track of which devices have which IP addresses, and create DNS records for them automatically.</p>
<p>Click on the &quot;DHCP&quot; tab, then click on &quot;Scopes&quot;, then click on &quot;Create&quot;.</p>
<p>This form will look a <em>bit</em> intimidating at first, but we&#x27;ll go through it.</p>
<p><img loading="lazy" alt="Creating a DHCP scope" src="/assets/images/gravity-create-dhcp-scope-25bf6a790ac07d41efd4537d6e1db52d.png" width="1778" height="1289" class="img_ev3q"></p>
<ul>
<li>
<p>Name: Give your scope a name. This can be anything you want, but it&#x27;s best to make it descriptive. In my case, I&#x27;ve called it &quot;RiffLab&quot;.</p>
</li>
<li>
<p>Subnet CIDR: CIDR is a shorthand way of describing a network range - a set of IP addresses that make up a network - in a way that&#x27;s short and easy for humans to understand. You&#x27;re most likely using a &quot;/24&quot; network - that is, 256 addresses (with 254 usable addresses). If you&#x27;re using a network of, let&#x27;s say, 192.168.1.x where X is the address of each computer, enter &quot;192.168.1.0/24&quot; here. In the case of RiffLab, we&#x27;ll use &quot;10.1.0.0/16&quot; since we&#x27;re using a /16 network with 65536 addresses (with 65534 usable addresses).</p>
</li>
<li>
<p>Router: This is the IP address of your router. In my case, it&#x27;s 10.1.1.1. Usually (but not always!) the first address in your network range belongs to a router.</p>
</li>
<li>
<p>TTL: This is the &quot;Time To Live&quot;, in seconds, of your DHCP leases. This is how long a device can keep an IP address before it has to renew it. By default, this is set to 86400 - in other words, one full day - but you can change it to whatever you want. I&#x27;ve set mine to 8 hours - 28,800 seconds.</p>
</li>
<li>
<p>IPAM: This section determines how IP addresses are handed out by the new DHCP service.</p>
<ul>
<li>
<p>IP Range Start: This is the first IP address that will be handed out by the DHCP service. For RiffLab, we&#x27;ll set it to 10.1.2.2. This allows us to keep 10.1.1.x for static network assets such as our Proxmox nodes, as well as other servers, routers and switches.</p>
</li>
<li>
<p>IP Range End: This is the last IP address that will be handed out by the DHCP service. For RiffLab, we&#x27;ll set it to 10.1.49.250.</p>
</li>
</ul>
</li>
</ul>
<p>Click the DNS settings section to expand it. Set &quot;DNS Zone&quot; to the DNS zone you created earlier.</p>
<p>Since we&#x27;re now using a highly available cluster, we&#x27;ll also want to click the Advanced section and set some DHCP Options, to allow us to tell clients which DNS servers they should be using. This is where it gets a BIT tricky, as you&#x27;ll need to know the IP addresses of your Gravity nodes - and encode them into something called <code>base64</code>.</p>
<p>Gather your three (or more) Gravity node&#x27;s IP addresses, and run them through this script. You&#x27;ll want to replace these IP addresses with your nodes, and follow the example.</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">echo -n &quot;10.1.1.151&quot; | awk -F&#x27;.&#x27; &#x27;{ printf &quot;%c%c%c%c&quot;, $1, $2, $3, $4 }&#x27; | base64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CgEBlw==</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo -n &quot;10.1.1.152&quot; | awk -F&#x27;.&#x27; &#x27;{ printf &quot;%c%c%c%c&quot;, $1, $2, $3, $4 }&#x27; | base64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CgEBmA==</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">echo -n &quot;10.1.1.153&quot; | awk -F&#x27;.&#x27; &#x27;{ printf &quot;%c%c%c%c&quot;, $1, $2, $3, $4 }&#x27; | base64</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CgEBmQ==</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>Once you have your base64-encoded strings, you can create your DNS configuration, which will now contain all three of your Gravity nodes. In the event that one of your nodes goes down, your clients will still be able to resolve DNS queries most of the time. (Some clients will still have issues, as they are not &quot;smart&quot; enough to retry DNS queries on another server automatically. Monitoring will help you keep track of when a node is having issues, and avoid reduction in &quot;WAF&quot;)</p>
<p>Enter the following into the DHCP Options field, replacing each value64 string with your own base64 encoded values:</p>
<div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">- tagName: name_server</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  value64:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - CgEBlw==</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - CgEBmA==</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    - CgEBmQ==</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>You&#x27;ll want to take a quick second to go turn off the DHCP server on your router - we&#x27;re about to create a DHCP server that will take over for it. This is the &quot;cutover&quot; we described earlier.</p>
<p>Now, click Create, and pat yourself on the back. You&#x27;ve just created your first highly available service!</p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/riffcc/rifflabs/tree/main/packages/create-docusaurus/templates/shared/docs/build/groundwork/dns-dhcp.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/build/groundwork/your-first-cluster"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Your first cluster</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/build/groundwork/your-first-vm"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Your first VM</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-youll-need" class="table-of-contents__link toc-highlight">What you&#39;ll need</a></li><li><a href="#what-is-high-availability" class="table-of-contents__link toc-highlight">What is High Availability?</a></li><li><a href="#what-is-gravity" class="table-of-contents__link toc-highlight">What is Gravity?</a></li><li><a href="#installing-gravity" class="table-of-contents__link toc-highlight">Installing Gravity</a><ul><li><a href="#what-is-ssh" class="table-of-contents__link toc-highlight">What is SSH?</a></li><li><a href="#logging-into-your-servers" class="table-of-contents__link toc-highlight">Logging into your servers</a></li><li><a href="#installing-docker" class="table-of-contents__link toc-highlight">Installing Docker</a></li><li><a href="#starting-gravity" class="table-of-contents__link toc-highlight">Starting Gravity</a></li></ul></li><li><a href="#logging-in" class="table-of-contents__link toc-highlight">Logging in</a><ul><li><a href="#visiting-your-first-gravity-node" class="table-of-contents__link toc-highlight">Visiting your first Gravity node</a></li><li><a href="#getting-your-password" class="table-of-contents__link toc-highlight">Getting your password</a></li><li><a href="#logging-in-for-the-first-time" class="table-of-contents__link toc-highlight">Logging in for the first time</a></li></ul></li><li><a href="#configuring-gravity" class="table-of-contents__link toc-highlight">Configuring Gravity</a><ul><li><a href="#creating-a-dns-zone" class="table-of-contents__link toc-highlight">Creating a DNS zone</a></li><li><a href="#creating-a-gravity-cluster" class="table-of-contents__link toc-highlight">Creating a Gravity cluster</a></li><li><a href="#creating-a-dhcp-scope" class="table-of-contents__link toc-highlight">Creating a DHCP scope</a></li></ul></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/build/intro">Build</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/facebook/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">© 2024 Riff.CC Project & Riff Labs.</div></div></div></footer></div>
</body>
</html>