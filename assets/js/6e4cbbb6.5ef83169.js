"use strict";(self.webpackChunkrifflab_docs=self.webpackChunkrifflab_docs||[]).push([[407],{8134:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>a,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var t=s(5893),r=s(1151);const o={sidebar_position:1},i="Shutdown procedures",l={id:"maintain/procedures/shutdown-procedures",title:"Shutdown procedures",description:"The goal of shutting down Riff.CC labs, for whatever reason the shutdown is happening, is to turn off all the equipment as gracefully as possible, in a way that should ensure the greatest chance of later being able to turn it all back on again.",source:"@site/docs/maintain/procedures/shutdown-procedures.md",sourceDirName:"maintain/procedures",slug:"/maintain/procedures/shutdown-procedures",permalink:"/docs/maintain/procedures/shutdown-procedures",draft:!1,unlisted:!1,editUrl:"https://github.com/riffcc/rifflabs/tree/main/packages/create-docusaurus/templates/shared/docs/maintain/procedures/shutdown-procedures.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"maintainSidebar",previous:{title:"Procedures",permalink:"/docs/category/procedures"},next:{title:"Startup procedures",permalink:"/docs/maintain/procedures/startup-procedures"}},a={},d=[{value:"Getting started",id:"getting-started",level:2},{value:"Shutdown the MooseFS filesystem",id:"shutdown-the-moosefs-filesystem",level:2},{value:"Shutdown Kubernetes",id:"shutdown-kubernetes",level:2},{value:"Shutdown the Farmer",id:"shutdown-the-farmer",level:2},{value:"Shutdown all major nodes",id:"shutdown-all-major-nodes",level:2},{value:"Shutdown the disk chassis and remaining equipment",id:"shutdown-the-disk-chassis-and-remaining-equipment",level:2}];function h(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",li:"li",p:"p",ul:"ul",...(0,r.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"shutdown-procedures",children:"Shutdown procedures"}),"\n",(0,t.jsx)(n.p,{children:"The goal of shutting down Riff.CC labs, for whatever reason the shutdown is happening, is to turn off all the equipment as gracefully as possible, in a way that should ensure the greatest chance of later being able to turn it all back on again."}),"\n",(0,t.jsx)(n.h2,{id:"getting-started",children:"Getting started"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Gather a rough idea of the state of the lab. Potentially take a quick photo and make a note of the event."}),"\n",(0,t.jsx)(n.li,{children:"If anything is messy or out of place, clean it up before you get started."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"shutdown-the-moosefs-filesystem",children:"Shutdown the MooseFS filesystem"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Turn off Jellyfin on Creature.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["SSH to creature as root and run ",(0,t.jsx)(n.code,{children:"systemctl stop jellyfin"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Begin by turning off the moosefs-pro-master service on the MooseFS master node. This will prevent any new data from being written to the MooseFS filesystem.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["This will currently by achievable via ssh root@10.1.1.154, then running ",(0,t.jsx)(n.code,{children:"systemctl stop moosefs-pro-master"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["(TODO): Then go to each host and run ",(0,t.jsx)(n.code,{children:"umount /mnt/mfs"})," to unmount the MooseFS filesystem from each host. This would be more safe than just turning hosts off, but we aren't actually going to do this just yet. Ignore this step. Will be an Ansible playbook in the future, which we can run to unmount MooseFS everywhere."]}),"\n",(0,t.jsxs)(n.li,{children:["Turn off all MooseFS chunkservers.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Currently these are the following hosts:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"10.1.1.154 - monstar - SSDs and HDDs"}),"\n",(0,t.jsx)(n.li,{children:"10.1.1.155 - al - HDDs"}),"\n",(0,t.jsx)(n.li,{children:"10.1.1.156 - ambellina - SSDs and HDDs"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["SSH to each host as root and run ",(0,t.jsx)(n.code,{children:"systemctl stop moosefs-pro-chunkserver"})]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"shutdown-kubernetes",children:"Shutdown Kubernetes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Shut down the Kubernetes workers. Run ",(0,t.jsx)(n.code,{children:"systemctl stop rke2-agent"})," on each of the Kubernetes workers:","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"10.1.1.154"}),"\n",(0,t.jsx)(n.li,{children:"10.1.1.155"}),"\n",(0,t.jsx)(n.li,{children:"10.1.1.156"}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["Shut down the Kubernetes masters. In CoreSVC Proxmox (",(0,t.jsx)(n.a,{href:"https://coresvc.riff.cc:8006",children:"https://coresvc.riff.cc:8006"}),') right click the following VMs and click "Stop":',"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"emerald-k8s-m01"}),"\n",(0,t.jsx)(n.li,{children:"emerald-k8s-m02"}),"\n",(0,t.jsx)(n.li,{children:"emerald-k8s-m03"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"shutdown-the-farmer",children:"Shutdown the Farmer"}),"\n",(0,t.jsxs)(n.p,{children:["Log onto the Farmer (",(0,t.jsx)(n.code,{children:"ssh root@monstar.riff.cc"}),") and run ",(0,t.jsx)(n.code,{children:"screen -r plotter"})," and hit Ctrl-C to stop the plotter/farmer."]}),"\n",(0,t.jsx)(n.h2,{id:"shutdown-all-major-nodes",children:"Shutdown all major nodes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Turn off al, ambellina, monstar, inferno, sizer"}),"\n",(0,t.jsx)(n.li,{children:"Turn off coheed, cambria, creature"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"shutdown-the-disk-chassis-and-remaining-equipment",children:"Shutdown the disk chassis and remaining equipment"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Wait for all machines to stop"}),"\n",(0,t.jsx)(n.li,{children:"Power off the UPSes"}),"\n",(0,t.jsx)(n.li,{children:"Turn off the wall socket to power off all equipment."}),"\n"]})]})}function c(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>l,a:()=>i});var t=s(7294);const r={},o=t.createContext(r);function i(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);