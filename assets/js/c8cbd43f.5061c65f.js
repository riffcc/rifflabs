"use strict";(self.webpackChunkrifflab_docs=self.webpackChunkrifflab_docs||[]).push([[74],{5869:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>r,contentTitle:()=>l,default:()=>b,frontMatter:()=>t,metadata:()=>a,toc:()=>c});var i=s(5893),o=s(1151);const t={sidebar_position:1},l="Robots",a={id:"build/getting-airborne/robots",title:"Robots",description:"We'll be building some robots to operate the lab. These robots will be virtual machines, which we'll create using Proxmox. We just created the first one and logged into it.",source:"@site/docs/build/getting-airborne/robots.md",sourceDirName:"build/getting-airborne",slug:"/build/getting-airborne/robots",permalink:"/docs/build/getting-airborne/robots",draft:!1,unlisted:!1,editUrl:"https://github.com/riffcc/rifflabs/tree/main/packages/create-docusaurus/templates/shared/docs/build/getting-airborne/robots.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"buildSidebar",previous:{title:"Setup - Getting Airborne",permalink:"/docs/category/setup---getting-airborne"},next:{title:"Building the base playbook",permalink:"/docs/build/getting-airborne/building-the-base-playbook"}},r={},c=[{value:"What is a robot?",id:"what-is-a-robot",level:2},{value:"What robots are we building?",id:"what-robots-are-we-building",level:2},{value:"Ansible",id:"ansible",level:2},{value:"Getting Ansible installed",id:"getting-ansible-installed",level:3},{value:"Ansible Playbooks",id:"ansible-playbooks",level:3}];function d(e){const n={a:"a",admonition:"admonition",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"robots",children:"Robots"}),"\n",(0,i.jsx)(n.p,{children:"We'll be building some robots to operate the lab. These robots will be virtual machines, which we'll create using Proxmox. We just created the first one and logged into it."}),"\n",(0,i.jsx)(n.h2,{id:"what-is-a-robot",children:"What is a robot?"}),"\n",(0,i.jsx)(n.p,{children:"A robot is a virtual machine which is used to perform specific lab tasks automatically and on a schedule, as well as a place for technicians to log into and perform tasks manually."}),"\n",(0,i.jsx)(n.h2,{id:"what-robots-are-we-building",children:"What robots are we building?"}),"\n",(0,i.jsx)(n.p,{children:"robot01 is a general purpose machine which we'll set up to do the following tasks:"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Create a base Ansible playbook which can be used to configure any machines in the network - including itself."}),"\n",(0,i.jsx)(n.li,{children:"Run an Ansible playbook to configure itself and the rest of the lab."}),"\n",(0,i.jsx)(n.li,{children:"Bootstrap some basic infrastructure using The Foreman."}),"\n"]}),"\n",(0,i.jsx)(n.h2,{id:"ansible",children:"Ansible"}),"\n",(0,i.jsx)(n.p,{children:"Ansible is a tool for automating the configuration of machines. It's a very powerful tool, and we'll be using it to configure all of the machines in the lab. We'll be using it to configure robot01 itself, using itself."}),"\n",(0,i.jsx)(n.h3,{id:"getting-ansible-installed",children:"Getting Ansible installed"}),"\n",(0,i.jsxs)(n.p,{children:["Let's start by installing the latest versions of ",(0,i.jsx)(n.code,{children:"ansible"}),", ",(0,i.jsx)(n.code,{children:"ansible-lint"}),", and ",(0,i.jsx)(n.code,{children:"yamllint"}),". You'll essentially be following ",(0,i.jsx)(n.a,{href:"https://docs.ansible.com/ansible/latest/installation_guide/intro_installation.html",children:"this guide"}),"."]}),"\n",(0,i.jsx)(n.p,{children:"On your own workstation, run the following:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"sudo apt update\nsudo apt install -y python3-pip pipx\npipx ensurepath\n"})}),"\n",(0,i.jsx)(n.p,{children:"Log out, and then back in. Then:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pipx install ansible\npipx install ansible-lint\npipx install yamllint\n"})}),"\n",(0,i.jsxs)(n.p,{children:["In this example, we've installed Ansible on the new ",(0,i.jsx)(n.code,{children:"robot01"})," machine, since it will also need to be able to run Ansible at some point."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"riff@robot01:~$ pipx install ansible\n  installed package ansible 9.1.0, installed using Python 3.11.2\n  These apps are now globally available\n    - ansible-community`\ndone! \u2728 \ud83c\udf1f \u2728\n"})}),"\n",(0,i.jsx)(n.p,{children:"Once you've installed Ansible on your workstation, you're ready to start using it."}),"\n",(0,i.jsx)(n.h3,{id:"ansible-playbooks",children:"Ansible Playbooks"}),"\n",(0,i.jsx)(n.p,{children:'An Ansible "playbook" is a bundle of code, manifests, templates and more that allows you to configure machines or sets of machines. We\'ll be using playbooks to configure all of the machines in the lab.'}),"\n",(0,i.jsxs)(n.p,{children:["Let's check out the ",(0,i.jsx)(n.code,{children:"rifflab-infrastructure"})," repository."]}),"\n",(0,i.jsx)(n.admonition,{type:"note",children:(0,i.jsxs)(n.p,{children:["You can use your own path instead of ",(0,i.jsx)(n.code,{children:"~/projects"})," below, but we suggest you use ",(0,i.jsx)(n.code,{children:"~/projects"})," to keep things consistent with our examples."]})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"mkdir -p ~/projects/ && cd ~/projects/\ngit clone git@github.com:riffcc/rifflabs-infrastructure.git\ncd rifflabs-infrastructure\ncd playbooks/base-playbook\n"})}),"\n",(0,i.jsx)(n.p,{children:"We've entered a directory containing a basic Ansible playbook. Let's have a look at what it looks like so far:"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"playbooks/base-playbook/deploy.yml"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"---\n- name: Apply basic configuration\n  hosts: all\n  become: true\n\n  roles:\n    - dns\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"playbooks/base-playbook/ansible.cfg"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-ini",children:"---\n[defaults]\ninventory = inventory\npipelining = True\n\n[ssh_connection]\nssh_args = -o ControlMaster=auto -o ControlPersist=60s\n"})}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.em,{children:"playbooks/base-playbook/tasks/main.yml"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"---\n- name: Ensure systemd-resolved is installed\n  package:\n    name: systemd-resolved\n    state: present\n\n- name: Ensure systemd-resolved is configured with the local DNS servers\n  community.general.ini_file:\n    path: /etc/systemd/resolved.conf\n    section: Resolve\n    option: DNS\n    values: \"{{ dns_servers }}\"\n    mode: '0600'\n    state: present\n  notify: Restart systemd-resolved\n"})}),"\n",(0,i.jsx)(n.p,{children:"We have a very basic structure, common for Ansible playbooks. If you want to learn more about Ansible, you should make your own playbook to build your developer workstation and install everything you normally need on your machine."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"wings@blackberry:~/projects/rifflabs-infrastructure/playbooks/base-playbook$ tree\n.\n\u251c\u2500\u2500 ansible.cfg\n\u251c\u2500\u2500 deploy.yml\n\u2514\u2500\u2500 roles\n    \u2514\u2500\u2500 dns\n        \u251c\u2500\u2500 defaults\n        \u2502\xa0\xa0 \u2514\u2500\u2500 main.yml\n        \u251c\u2500\u2500 handlers\n        \u2502\xa0\xa0 \u2514\u2500\u2500 main.yml\n        \u2514\u2500\u2500 tasks\n            \u2514\u2500\u2500 main.yml\n"})}),"\n",(0,i.jsxs)(n.p,{children:["There's a great book by Jeff Geerling called ",(0,i.jsx)(n.a,{href:"https://www.ansiblefordevops.com/",children:"Ansible for DevOps"}),", which we highly recommend. The book is now totally free and open source, too!"]})]})}function b(e={}){const{wrapper:n}={...(0,o.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},1151:(e,n,s)=>{s.d(n,{Z:()=>a,a:()=>l});var i=s(7294);const o={},t=i.createContext(o);function l(e){const n=i.useContext(t);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(o):e.components||o:l(e.components),i.createElement(t.Provider,{value:n},e.children)}}}]);